@model List<Task_2___Issue_Report_Web_.Models.ServiceRequest>
@using Task_2___Issue_Report_Web_.Models
@{
    ViewData["Title"] = "Top Priority Service Requests";
}

<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h2 class="mb-1"><i class="fas fa-star me-2"></i>Top Priority Service Requests</h2>
                <p class="text-muted mb-0">Highest priority requests managed using Min Heap data structure</p>
            </div>
            <div class="d-flex align-items-center">
                <img src="~/img/Logo_of_Cape_Town,_South_Africa.png" alt="City" class="brand-logo me-3" />
                <a class="btn btn-secondary" href="/ServiceRequestStatus"><i class="fas fa-arrow-left me-2"></i>Back to List</a>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            These requests are prioritized using a Min Heap data structure, ensuring the most urgent requests are displayed first.
        </div>

        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <div class="card">
                    <div class="card-body">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h4>No priority requests found</h4>
                        <p class="text-muted">All service requests have been processed or are at normal priority levels.</p>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Priority</th>
                            <th>Request ID</th>
                            <th>Category</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Submitted</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var request in Model)
                        {
                            <tr>
                                <td>
                                    @{
                                        var priorityClass = request.Priority <= 2 ? "bg-danger" : request.Priority <= 4 ? "bg-warning" : "bg-secondary";
                                    }
                                    <span class="badge @priorityClass fs-6">
                                        <i class="fas fa-flag me-1"></i>@request.Priority
                                    </span>
                                </td>
                                <td>
                                    <strong class="text-primary">@request.RequestId</strong>
                                </td>
                                <td>
                                    <span class="badge bg-info">@request.Category</span>
                                </td>
                                <td>
                                    <i class="fas fa-map-marker-alt me-1 text-muted"></i>@request.Location
                                </td>
                                <td>
                                    @{
                                        var statusClass = request.Status switch
                                        {
                                            RequestStatus.Submitted => "bg-secondary",
                                            RequestStatus.UnderReview => "bg-info",
                                            RequestStatus.InProgress => "bg-primary",
                                            RequestStatus.OnHold => "bg-warning",
                                            RequestStatus.Resolved => "bg-success",
                                            RequestStatus.Closed => "bg-dark",
                                            _ => "bg-secondary"
                                        };
                                    }
                                    <span class="badge @statusClass">@request.Status</span>
                                </td>
                                <td>
                                    <small>@request.SubmittedAt.ToLocalTime().ToString("MMM dd, yyyy")</small>
                                </td>
                                <td>
                                    <a href="/ServiceRequestStatus/Details?requestId=@request.RequestId" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye me-1"></i>View Details
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

